[build]
  command = "npm ci --legacy-peer-deps && npm run build"
  publish = "dist"
  functions = "netlify/functions"

[build.environment]
  NODE_VERSION = "22"
  NPM_FLAGS = "--legacy-peer-deps"

[[plugins]]
  package = "@netlify/plugin-functions-install-core"

# Background function configuration for long-running insights generation
[functions."generate-insights-background"]
  external_node_modules = ["@google/generative-ai"]

# Admin diagnostics function - needs longer timeout for comprehensive testing
[functions."admin-diagnostics"]
  # Note: This is a hint; actual timeout depends on Netlify plan tier
  # Free: 10s, Pro: 26s, Business+: 26s
  # Tests run in parallel to stay well under limits

[context.production.environment]
  LOG_LEVEL = "INFO"
[context.deploy-preview.environment]
  LOG_LEVEL = "DEBUG"
