[ ] NAME:Current Task List DESCRIPTION:Root task for conversation __NEW_AGENT__
-[/] NAME:Update Gemini Model to 2.5 Flash - Comprehensive Migration DESCRIPTION:Migrate all Gemini model references from gemini-2.0-flash-exp to gemini-2.5-flash (latest stable model) across the entire codebase
--[x] NAME:Phase 1: Update Core Gemini Configuration DESCRIPTION:Update the central configuration file and Gemini client to use gemini-2.5-flash as the default model
---[x] NAME:Update netlify/functions/utils/config.cjs DESCRIPTION:Change line 40: model: process.env.GEMINI_MODEL || 'gemini-2.5-flash' (was gemini-2.0-flash-exp)
---[x] NAME:Update netlify/functions/utils/geminiClient.cjs DESCRIPTION:Change line 218: const model = options.model || 'gemini-2.5-flash' (was gemini-2.0-flash-exp). Note: This file already uses v1beta API endpoint which is correct for 2.5 models
--[x] NAME:Phase 2: Update Insights Generation Functions DESCRIPTION:Update all three insights generation functions to use gemini-2.5-flash
---[x] NAME:Update netlify/functions/generate-insights.cjs DESCRIPTION:Change line 727: model: 'gemini-2.5-flash' (was gemini-2.0-flash-exp). Update log message on line 736 to say 'Gemini 2.5 Flash model initialized successfully'
---[x] NAME:Update netlify/functions/generate-insights-with-tools.cjs DESCRIPTION:Change line 242: model: 'gemini-2.5-flash' (was gemini-2.0-flash-exp). This is the enhanced mode function that uses function calling
---[x] NAME:Update netlify/functions/generate-insights-clean.cjs DESCRIPTION:Change line 270: model: 'gemini-2.5-flash' (was gemini-2.0-flash-exp). This is the clean version of insights generation
--[x] NAME:Phase 3: Update Supporting Functions DESCRIPTION:Update predictive maintenance, analysis pipeline, and admin diagnostics to use gemini-2.5-flash
---[x] NAME:Update netlify/functions/predictive-maintenance.cjs DESCRIPTION:Change line 413: model: 'gemini-2.5-flash' (was gemini-2.0-flash-exp). This function generates AI insights for predictive maintenance schedules
---[x] NAME:Update netlify/functions/utils/analysis-pipeline.cjs DESCRIPTION:Change line 48: const modelName = process.env.GEMINI_MODEL || 'gemini-2.5-flash' (was gemini-2.0-flash-exp). Update comment on line 47 to say 'Use Gemini 2.5 Flash (latest stable model)'
---[x] NAME:Update netlify/functions/admin-diagnostics.cjs DESCRIPTION:Change line 208: model: 'gemini-2.5-flash' (was gemini-2.0-flash-exp). This is used for health check diagnostics
--[/] NAME:Phase 4: Improve Fallback Logic DESCRIPTION:Enhance fallback functions to provide real data analysis instead of hardcoded values
---[/] NAME:Enhance fallbackTextSummary in generate-insights.cjs DESCRIPTION:Improve the fallback function to analyze actual battery data instead of returning hardcoded values. Calculate real metrics from batteryData.measurements array including: actual capacity retention, real degradation rate, data-driven health status, and meaningful recommendations based on trends
---[ ] NAME:Enhance fallbackTextSummary in generate-insights-clean.cjs DESCRIPTION:Improve the fallback function (line 407) to provide real analysis. Currently returns generic text with hardcoded values. Should calculate actual performance metrics from batteryData
---[ ] NAME:Add data validation to prevent NaN values DESCRIPTION:Add validation in fallback functions to check for null/undefined values before calculations. Ensure generator recommendations never show 'NaN' by validating all numeric inputs
--[ ] NAME:Phase 5: Add Model Fallback Chain DESCRIPTION:Implement automatic fallback from 2.5-flash → 2.0-flash → fallback analysis
---[ ] NAME:Implement model fallback in getAIModel functions DESCRIPTION:Update getAIModel functions in generate-insights.cjs, generate-insights-with-tools.cjs, and generate-insights-clean.cjs to try gemini-2.5-flash first, then gemini-2.0-flash if 404 error, then fallback to text analysis. Add logging for which model is being used
---[ ] NAME:Add retry logic with model fallback in geminiClient.cjs DESCRIPTION:Enhance the _sendRequest method to detect 404 model not found errors and automatically retry with gemini-2.0-flash. Log which model succeeded
---[ ] NAME:Add user-facing error messages DESCRIPTION:When LLM fails, provide clear error messages to users explaining what happened (e.g., 'AI analysis unavailable, using statistical analysis' instead of generic errors)
--[ ] NAME:Phase 6: Update Tests DESCRIPTION:Update all test files to reference gemini-2.5-flash instead of gemini-2.0-flash-exp
---[ ] NAME:Update tests/generate-insights-enhanced-mode.test.js DESCRIPTION:Change line 10: const expectedModel = 'gemini-2.5-flash' (was gemini-2.0-flash-exp). Update test to verify we're not using deprecated 2.0 models
---[ ] NAME:Update tests/setup.js mock DESCRIPTION:Update the Gemini API mock to reflect the new model name in comments/documentation. The mock itself doesn't need to change functionally, but should document that it's mocking gemini-2.5-flash
---[ ] NAME:Update test-gemini-fix.js DESCRIPTION:Change line 22: const modelName = process.env.GEMINI_MODEL || 'gemini-2.5-flash' (was gemini-1.5-flash). This test script validates Gemini API configuration
--[ ] NAME:Phase 7: Build and Test DESCRIPTION:Run build, execute tests, and verify all changes work correctly
---[ ] NAME:Run npm run build DESCRIPTION:Execute the build command to ensure all TypeScript compiles and Vite bundles successfully. Per coding standards: must build successfully before completing request
---[ ] NAME:Run npm test DESCRIPTION:Execute all Jest tests to verify no regressions. All 198 tests should pass. Check for any console.error calls that might break tests
---[ ] NAME:Manual test: Standard mode insights DESCRIPTION:Test standard insights generation with real battery data. Verify: (1) No instant generation (should take >1s), (2) No NaN values, (3) Real data-driven insights, (4) Proper health status
---[ ] NAME:Manual test: Enhanced mode insights DESCRIPTION:Test enhanced mode with function calling. Verify: (1) No 404 errors, (2) Function calls execute (history, weather, analytics), (3) Enhanced insights include historical context, (4) No 'partial data due to error' messages
---[ ] NAME:Verify fallback quality DESCRIPTION:Test fallback by temporarily removing GEMINI_API_KEY. Verify: (1) Fallback provides real analysis not hardcoded values, (2) No NaN values, (3) Reasonable recommendations based on data